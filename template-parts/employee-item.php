<?php
if ( ! isset( $post ) ) {
    global $post;
}
if ( ! $post ) return;

$post_id = $post->ID;
$photo = get_the_post_thumbnail_url( $post_id, 'medium' ) ?: get_template_directory_uri() . '/assets/img/user-photo2.png';
$job = get_post_meta( $post_id, 'job_title', true );
$dept_names = wp_get_post_terms( $post_id, 'department', [ 'fields' => 'names' ] );
$dept_label = ! empty( $dept_names ) ? implode( ', ', $dept_names ) : '';

$position = get_post_meta($post_id, 'position', true);
$descriptions = get_field('descriptions', $post_id);
$phone = get_post_meta( $post_id, 'phone', true );
$email = get_post_meta( $post_id, 'email', true );
?>
<div class="user-item" data-employee-id="<?php echo esc_attr( $post_id ); ?>">
    <img src="<?php echo esc_url( $photo ); ?>" alt="" class="user-img">
    <div>
        <div class="block-title"><?php echo esc_html( get_the_title( $post_id ) ); ?></div>
        <?php if ( $position ) : ?><div class="user-job"><?php echo esc_html( $position ); ?></div><?php endif; ?>
        <?php if ( !empty($descriptions) ) : ?>
        <?php foreach ( $descriptions as $description ) : ?>
            <p class="event-desc"><?php echo esc_html( $description['text'] ); ?></p>
        <?php endforeach; ?>
        <?php endif; ?>

        <?php if ( $phone ) : ?>
            <a href="tel:<?php echo esc_attr( $phone ); ?>" class="user-contact">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                    <path d="M15.4001 17.75H15.1701C12.5789 17.4681 10.0894 16.5846 7.9001 15.17C5.86627 13.8747 4.13947 12.1513 2.8401 10.12C1.42225 7.92501 0.538617 5.42823 0.260096 2.83001C0.228249 2.52011 0.259692 2.20696 0.352517 1.90958C0.445342 1.6122 0.597615 1.33677 0.800096 1.10001C0.997034 0.86008 1.24012 0.662109 1.51495 0.517823C1.78978 0.373536 2.09077 0.285868 2.4001 0.26001H5.0001C5.56321 0.260578 6.10756 0.462477 6.53485 0.829248C6.96214 1.19602 7.2442 1.70349 7.3301 2.26001C7.42504 2.97489 7.60291 3.67628 7.8601 4.35001C8.01654 4.77339 8.04882 5.23264 7.95316 5.67375C7.8575 6.11485 7.63787 6.51947 7.3201 6.84001L6.7101 7.45001C7.67051 8.96621 8.95881 10.2477 10.4801 11.2L11.0901 10.6C11.4106 10.2822 11.8153 10.0626 12.2564 9.96694C12.6975 9.87128 13.1567 9.90357 13.5801 10.06C14.2546 10.3148 14.9557 10.4926 15.6701 10.59C16.2361 10.6751 16.7516 10.9638 17.1199 11.402C17.4881 11.8403 17.6838 12.3978 17.6701 12.97V15.37C17.6701 15.9942 17.4228 16.593 16.9824 17.0353C16.542 17.4776 15.9443 17.7274 15.3201 17.73L15.4001 17.75ZM5.0001 1.75001H2.6101C2.49275 1.75777 2.37819 1.78924 2.27334 1.84252C2.1685 1.8958 2.07554 1.96979 2.0001 2.06001C1.92667 2.14452 1.8711 2.24302 1.83673 2.34957C1.80235 2.45612 1.7899 2.56852 1.8001 2.68001C2.04258 5.03679 2.83371 7.304 4.1101 9.30001C5.28674 11.1467 6.85341 12.7134 8.7001 13.89C10.6973 15.1798 12.9671 15.9878 15.3301 16.25C15.453 16.2569 15.576 16.2383 15.6913 16.1953C15.8066 16.1522 15.9118 16.0857 16.0001 16C16.1593 15.8368 16.2489 15.6181 16.2501 15.39V13C16.2546 12.7896 16.1818 12.5848 16.0454 12.4244C15.909 12.2641 15.7185 12.1593 15.5101 12.13C14.6839 12.0189 13.8724 11.8177 13.0901 11.53C12.936 11.4724 12.7687 11.4596 12.6076 11.4933C12.4465 11.5269 12.2983 11.6055 12.1801 11.72L11.1801 12.72C11.063 12.8342 10.9121 12.9076 10.75 12.9292C10.5878 12.9508 10.423 12.9195 10.2801 12.84C8.14627 11.6342 6.38006 9.87146 5.1701 7.74001C5.08728 7.59798 5.05411 7.43241 5.07584 7.26944C5.09757 7.10647 5.17296 6.95538 5.2901 6.84001L6.2901 5.84001C6.40478 5.72403 6.48367 5.57751 6.51736 5.41793C6.55105 5.25835 6.53811 5.09244 6.4801 4.94001C6.19129 4.15799 5.99006 3.34637 5.8801 2.52001C5.85529 2.30528 5.75142 2.10747 5.58875 1.96513C5.42607 1.82278 5.21622 1.7461 5.0001 1.75001Z" fill="#64748B"/>
                </svg>
                <?php echo esc_html( $phone ); ?>
            </a>
        <?php endif; ?>
        <?php if ( $email ) : ?>
            <a href="mailto:<?php echo esc_attr( $email ); ?>" class="user-contact">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 18 16" fill="none">
                    <path d="M16 0.25H2C1.53668 0.252625 1.09309 0.437842 0.765464 0.765464C0.437842 1.09309 0.252625 1.53668 0.25 2V14C0.252625 14.4633 0.437842 14.9069 0.765464 15.2345C1.09309 15.5622 1.53668 15.7474 2 15.75H16C16.4633 15.7474 16.9069 15.5622 17.2345 15.2345C17.5622 14.9069 17.7474 14.4633 17.75 14V2C17.7474 1.53668 17.5622 1.09309 17.2345 0.765464C16.9069 0.437842 16.4633 0.252625 16 0.25ZM2 1.75H16C16.0663 1.75 16.1299 1.77634 16.1768 1.82322C16.2237 1.87011 16.25 1.9337 16.25 2V3.54L9 7.16L1.75 3.54V2C1.75 1.9337 1.77634 1.87011 1.82322 1.82322C1.87011 1.77634 1.9337 1.75 2 1.75ZM16 14.25H2C1.9337 14.25 1.87011 14.2237 1.82322 14.1768C1.77634 14.1299 1.75 14.0663 1.75 14V5.21L8.66 8.67C8.76556 8.7228 8.88197 8.75029 9 8.75029C9.11803 8.75029 9.23444 8.7228 9.34 8.67L16.25 5.21V14C16.25 14.0663 16.2237 14.1299 16.1768 14.1768C16.1299 14.2237 16.0663 14.25 16 14.25Z" fill="#64748B"/>
                </svg>
                <?php echo esc_html( $email ); ?>
            </a>
        <?php endif; ?>
    </div>
    <span class="user-action">
        <!-- three-dots action icon (keep your svg) -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M12 17.25C12.9665 17.25 13.75 18.0335 13.75 19C13.75 19.9665 12.9665 20.75 12 20.75C11.0335 20.75 10.25 19.9665 10.25 19C10.25 18.0335 11.0335 17.25 12 17.25ZM12 10.25C12.9665 10.25 13.75 11.0335 13.75 12C13.75 12.9665 12.9665 13.75 12 13.75C11.0335 13.75 10.25 12.9665 10.25 12C10.25 11.0335 11.0335 10.25 12 10.25ZM12 3.25C12.9665 3.25 13.75 4.0335 13.75 5C13.75 5.9665 12.9665 6.75 12 6.75C11.0335 6.75 10.25 5.9665 10.25 5C10.25 4.0335 11.0335 3.25 12 3.25Z" fill="black"/>
        </svg>
    </span>
</div>
